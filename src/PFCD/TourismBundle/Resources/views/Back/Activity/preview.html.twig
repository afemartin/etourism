{% extends 'PFCDTourismBundle:Back:layout.html.twig' %}

{% block stylesheets %}
{{ parent() }}
<link href="{{ asset('css/fancybox-1.3.4.css') }}" type="text/css" rel="stylesheet" />
{% endblock %}

{% block body %}
<div class="info-container row">
    <div class="info-title span9">
        <h1>{{ activity.title }}</h1>
    </div>
    <div class="info-desc span9">
        {% if activity.video %}
        <div class="info-video pull-right">
            {{ activity.video|raw }}
        </div>
        {% endif %}
        <p>{{ activity.shortDesc }}</p>
        {{ activity.fullDesc|raw }}
    </div>
            
    <div class="span3">
        <div class="well mini">
            <h1>{{ 'Preview'|trans }}</h1>
            <a class="btn btn-primary" href="{{ path('back_activity_update', { 'id': activity.id }) }}"><i class="icon-pencil icon-white"></i> {{ 'back.activity.button.update'|trans }}</a>
            <a class="btn btn-primary" href="{{ path('back_activity_media', { 'id': activity.id }) }}"><i class="icon-picture icon-white"></i> {{ 'back.activity.button.media'|trans }}</a>
        </div>
    </div>
</div>

{% if calendar %}
<h2>{{ 'front.activity.read.availability'|trans }}</h2>
<div class="info-calendar row">
    <div class="span9">
        <table class="calendar table table-bordered">
            <thead>
                <tr>
                    {% for year, days in calendar.years %}
                    <th colspan="{{ days }}">{{ year }}</th>
                    {% endfor %} 
                </tr>
                <tr>
                    {% for month, days in calendar.months %}
                    <th colspan="{{ days }}">{{ month|trans }}</th>
                    {% endfor %} 
                </tr>
                <tr>
                    {% for date in calendar.dates %}
                    <td>{{date.dayweek|trans}}</td>
                    {% endfor %}
                </tr>
                <tr>
                    {% for date in calendar.dates %}
                    <td>{{date.daymonth}}</td>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
            <tr>
                {% for date in calendar.dates %}
                <td style="background-color: rgb({{ 25*(10-date.capacity) }},{{ 25*date.capacity }},0)">{{date.capacity}}</td>
                {% endfor %}
            </tr>
            </tbody>
        </table>
        <a class="btn btn-primary pull-right" disabled="disabled"><i class="icon-pencil icon-white"></i> {{ 'front.reservation.button.create'|trans }}</a>
    </div>
</div>
{% endif %}

{% if activity.gallery %}
<h2>{{ 'front.activity.read.images'|trans }}</h2>
<div class="info-carrousel row">
    <div class="span9">
        <ul class="thumbnails">
            {% for image in activity.gallery %}
            <li class="span">
                <a class="info-image thumbnail" href="{{ asset(image.path) }}" title="{{ image.description }}" rel="images">
                    <img src="{{ image.path|apply_filter('thumbnail_180x120') }}" />
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endif %}

{% if activity.geolocation %}
<h2>{{ 'front.activity.read.geolocation'|trans }}</h2>
<div class="info-map row">
    <div class="span">
        <div id="map_modal" class="modal hide">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">Ã—</button>
                <h3>{{ 'front.activity.read.geolocation'|trans }}</h3>
            </div>
            <div class="modal-body">
                <div id="map_canvas"></div>
            </div>
        </div>
        <a class="thumbnail">
            <img src="http://maps.googleapis.com/maps/api/staticmap?maptype=hybrid&size=640x320&zoom=10&markers=color:blue|{{ activity.geolocation }}&sensor=false" onclick="initialize()"/>
        </a>
    </div>
</div>
{% endif %}

{% endblock %}

{% block javascripts %}
{{ parent() }}
<script type="text/javascript">
    $('#navbar-tab-activity').addClass("active");
</script>

<script type="text/javascript" src="{{ asset('js/fancybox-1.3.4.min.js') }}"></script>
<script type="text/javascript">
    $("a.info-image").fancybox( { 'titlePosition' : 'over' } );
</script>

{% if activity.geolocation %}
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key={{ google_maps_key }}&sensor=false"></script>
<script type="text/javascript">
    function initialize() {
        var latlng = new google.maps.LatLng({{ activity.geolocation }});
        var myOptions = {zoom: 10, scrollwheel: false, scaleControl: true, center: latlng, mapTypeId: google.maps.MapTypeId.HYBRID};
        var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
        var title = "{{ activity.title }}";
        var marker = new google.maps.Marker({ position: latlng, map: map, title: title });
        var infowindow = new google.maps.InfoWindow({ content: title });

        google.maps.event.addListener(marker, 'click', function() {
            infowindow.open(map, marker);
        });
        
        $('#map_modal').modal('show');
        
        // each time the google map modal is open it resize and set the original center position
        google.maps.event.trigger(map, 'resize');
        map.setCenter(marker.getPosition());
    }
</script>
{% endif %}
{% endblock %}