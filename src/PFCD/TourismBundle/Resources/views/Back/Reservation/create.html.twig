{% extends 'PFCDTourismBundle:Back:layout.html.twig' %}

{% form_theme form 'PFCDTourismBundle:Form:fields.html.twig' %}

{% set sectiontab = 'reservation' %}{% set datepicker = 1 %}

{% block body %}
<h1>{{ 'back.reservation.create.title'|trans }}</h1>
<p>{{ 'back.reservation.create.subtitle'|trans }}</p>

<form class="form-horizontal" action="{{ path('back_reservation_create') }}" method="post" {{ form_enctype(form) }}>
    {{ form_widget(form) }}
    <div class="form-actions">
        <button class="btn btn-success" type="submit"><i class="icon-ok icon-white"></i> {{ 'Create'|trans }}</button>
        <a class="btn btn-inverse" href="{{ path('back_reservation_index') }}"><i class="icon-remove icon-white"></i> {{ 'Cancel'|trans }}</a>
    </div>
</form>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $('#reservation_session').after('<div class="control-group"><div id="reservation_calendar" class="controls"></div></div>')
        $('#reservation_activity').change(function() {
            if ($(this).val())
            {
                getCalendar($(this).val(), {{ 'now'|date('Y') }}, {{ 'now'|date('m') }});
            }
        });
        
        function getCalendar(id, year, month)
        {
            $('#reservation_calendar').prepend('<i class="icon-loading"></i> {{ 'Loading'|trans }}...');
            document.getElementById('reservation_session').value = "";
            
            $.ajax({
                type: "GET",
                data: "id=" + id + "&year=" + year + "&month=" + month,
                url: "{{ path('back_activity_calendar') }}",
                success: function(calendar) { $('#reservation_calendar').html(calendar); }
            });
        }
        
        function selectSession(id)
        {
            document.getElementById('reservation_session').value = id;
            $('.calendar .label.active').removeClass('active');
            $('.session'+id).addClass('active');
        }
    </script>
{% endblock %}