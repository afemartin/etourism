{% extends 'PFCDTourismBundle:Back:layout.html.twig' %}

{% form_theme edit_form 'PFCDTourismBundle:Form:fields.html.twig' %}

{% set sectiontab = 'reservation' %}{% set datepicker = 1 %}

{% block body %}
<h1>{{ 'back.reservation.update.title'|trans }}</h1>
<p>{{ 'back.reservation.update.subtitle'|trans }}</p>

<form class="form-horizontal" action="{{ path('back_reservation_update', { 'id': reservation.id }) }}" method="post" {{ form_enctype(edit_form) }}>
    {{ form_widget(edit_form) }}
    <div class="form-actions">
        <button class="btn btn-success" type="submit"><i class="icon-ok icon-white"></i> {{ 'Save changes'|trans }}</button>
        <a class="btn btn-inverse" href="{{ path('back_reservation_read', { 'id': reservation.id }) }}"><i class="icon-remove icon-white"></i> {{ 'Cancel changes'|trans }}</a>
    </div>
</form>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $('#reservation_session').after('<div class="control-group"><div id="reservation_calendar" class="controls"></div></div>')
        getCalendar({{ reservation.session.activity.id }}, {{ reservation.session.date|date('Y') }}, {{ reservation.session.date|date('m') }});
        
        function getCalendar(id, year, month)
        {
            $('#reservation_calendar').prepend('<i class="icon-loading"></i> {{ 'Loading'|trans }}...');
            
            $.ajax({
                type: "GET",
                data: "id=" + id + "&year=" + year + "&month=" + month,
                url: "{{ path('back_activity_calendar') }}",
                success: function(calendar) {
                    $('#reservation_calendar').html(calendar);
                    selectSession({{ reservation.session.id}});
                }
            });
        }
        
        function selectSession(id)
        {
            document.getElementById('reservation_session').value = id;
            $('.calendar .label.active').removeClass('active');
            $('.session'+id).addClass('active');
        }
    </script>
{% endblock %}